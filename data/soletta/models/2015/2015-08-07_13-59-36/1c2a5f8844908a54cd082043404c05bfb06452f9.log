"2015-08-07 13:59:36 -0300"
diff --git a/src/shared/Makefile b/src/shared/Makefile
index ed5776d3..6e010151 100644
--- a/src/shared/Makefile
+++ b/src/shared/Makefile
@@ -1,16 +1,14 @@
 obj-y += libshared.mod
 
 obj-libshared-y := \
-    sol-fbp-graph.o \
-    sol-fbp-internal-log.o \
-    sol-fbp-internal-scanner.o \
     sol-monitors.o \
     sol-util.o
 
-ifeq (y,$(FLOW))
-obj-libshared-y += \
+obj-libshared-$(FLOW) += \
+    sol-fbp-graph.o \
+    sol-fbp-internal-log.o \
+    sol-fbp-internal-scanner.o \
     sol-fbp-parser.o
-endif
 
 ifeq (y,$(SOL_PLATFORM_LINUX))
 obj-libshared-y += \
diff --git a/src/test/Kconfig b/src/test/Kconfig
index 706e65ae..560f913f 100644
--- a/src/test/Kconfig
+++ b/src/test/Kconfig
@@ -13,10 +13,12 @@ config TEST_COAP
 
 config TEST_FBP
 	bool "fbp"
+	depends on FLOW
 	default y
 
 config TEST_FBP_SCANNER
 	bool "fbp scanner"
+	depends on FLOW
 	default y
 
 config TEST_FLOW